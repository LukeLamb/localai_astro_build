---
// Beta Signup Form Component
// Reusable form for collecting beta waitlist signups
---

<div class="beta-signup-wrapper">
  <form id="beta-signup-form" class="space-y-6">
    <!-- Web3Forms Access Key -->
    <input
      type="hidden"
      name="access_key"
      value="db5f2a1d-22b0-446f-a71b-0cd8f3f4436a"
    />
    <input
      type="hidden"
      name="subject"
      value="New Beta Signup - Local AI Finance"
    />
    <input
      type="hidden"
      name="from_name"
      value="LocalAI Finance Beta Program"
    />

    <!-- Honeypot Spam Protection -->
    <input
      type="checkbox"
      name="botcheck"
      class="hidden"
      style="display: none;"
    />

    <!-- Email & Name -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label
          for="beta-name"
          class="block text-sm font-medium text-light mb-2"
        >
          Name *
        </label>
        <input
          type="text"
          id="beta-name"
          name="name"
          required
          class="w-full px-4 py-3 rounded-lg border border-dark-border bg-dark text-light focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200"
          placeholder="Your name"
        />
      </div>

      <div>
        <label
          for="beta-email"
          class="block text-sm font-medium text-light mb-2"
        >
          Email *
        </label>
        <input
          type="email"
          id="beta-email"
          name="email"
          required
          class="w-full px-4 py-3 rounded-lg border border-dark-border bg-dark text-light focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200"
          placeholder="your@email.com"
        />
      </div>
    </div>

    <!-- Trading Experience -->
    <div>
      <label
        for="beta-experience"
        class="block text-sm font-medium text-light mb-2"
      >
        Trading Experience *
      </label>
      <select
        id="beta-experience"
        name="experience"
        required
        class="w-full px-4 py-3 rounded-lg border border-dark-border bg-dark text-light focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200"
      >
        <option value="">Select your experience level...</option>
        <option value="none">Complete Beginner</option>
        <option value="lost">Tried before, lost money</option>
        <option value="some">Some experience</option>
        <option value="experienced">Experienced trader</option>
      </select>
    </div>

    <!-- Beta Tier Preference -->
    <div>
      <label
        for="beta-tier"
        class="block text-sm font-medium text-light mb-2"
      >
        Which tier interests you? *
      </label>
      <select
        id="beta-tier"
        name="tier"
        required
        class="w-full px-4 py-3 rounded-lg border border-dark-border bg-dark text-light focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200"
      >
        <option value="">Select a tier...</option>
        <option value="free">🥉 Free - Education (Levels 1-25)</option>
        <option value="pro">🥈 Pro ($15/mo) - Paper Trading + AI Agents</option>
        <option value="elite">🥇 Elite ($50/mo) - Live Trading + All Features</option>
      </select>
    </div>

    <!-- Submit Button -->
    <div>
      <button
        type="submit"
        class="btn btn-primary w-full text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
      >
        🚀 Join Beta Waitlist
      </button>
    </div>

    <!-- Success Message (Hidden by default) -->
    <div
      id="success-message"
      class="hidden p-6 glass-card border-success text-center"
    >
      <div class="text-4xl mb-3">🎉</div>
      <h3 class="text-xl font-bold text-success mb-2 font-display">Welcome to the Journey!</h3>
      <p class="text-light-muted mb-4">
        Thanks for joining us! Check your email for next steps and exclusive updates as we build the future of AI-powered trading education.
      </p>
      <div class="space-y-2 text-sm text-light-muted mb-4">
        <p><span class="text-success">✓</span> Beta access confirmed</p>
        <p><span class="text-success">✓</span> Get exclusive development updates</p>
      </div>
      <a
        href="https://discord.gg/4YKHBRyVXJ"
        target="_blank"
        rel="noopener noreferrer"
        class="btn btn-primary inline-block"
      >
        Join Our Discord Community
      </a>
    </div>

    <!-- Trust Signals -->
    <div
      class="text-center text-sm text-light-muted space-y-2 pt-4 border-t border-dark-border"
    >
      <p><span class="text-success">✓</span> No spam, unsubscribe anytime</p>
      <p><span class="text-success">✓</span> Priority access guaranteed</p>
      <p><span class="text-success">✓</span> Your data is never shared</p>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const betaForm = document.getElementById(
      "beta-signup-form"
    ) as HTMLFormElement;

    if (betaForm) {
      // Add visual feedback for radio/checkbox selections
      const experienceOptions = betaForm.querySelectorAll(".experience-option");
      experienceOptions.forEach((option) => {
        const radio = option.querySelector(
          'input[type="radio"]'
        ) as HTMLInputElement;
        radio?.addEventListener("change", () => {
          experienceOptions.forEach((opt) =>
            opt.classList.remove("border-blue-500", "bg-blue-50")
          );
          if (radio.checked) {
            option.classList.add("border-blue-500", "bg-blue-50");
          }
        });
      });

      const tierOptions = betaForm.querySelectorAll(".tier-option");
      tierOptions.forEach((option) => {
        const radio = option.querySelector(
          'input[type="radio"]'
        ) as HTMLInputElement;
        radio?.addEventListener("change", () => {
          tierOptions.forEach((opt) =>
            opt.classList.remove("border-blue-500", "bg-blue-50")
          );
          if (radio.checked) {
            option.classList.add("border-blue-500", "bg-blue-50");
          }
        });
      });

      const assetOptions = betaForm.querySelectorAll(".asset-option");
      assetOptions.forEach((option) => {
        const checkbox = option.querySelector(
          'input[type="checkbox"]'
        ) as HTMLInputElement;
        checkbox?.addEventListener("change", () => {
          if (checkbox.checked) {
            option.classList.add("border-blue-500", "bg-blue-50");
          } else {
            option.classList.remove("border-blue-500", "bg-blue-50");
          }
        });
      });

      // Handle form submission
      betaForm.addEventListener("submit", async function (e) {
        e.preventDefault();

        const submitButton = betaForm.querySelector(
          'button[type="submit"]'
        ) as HTMLButtonElement;
        const successMessage = document.getElementById("success-message");

        // Show loading state
        if (submitButton) {
          submitButton.disabled = true;
          submitButton.innerHTML = `
            <svg class="animate-spin h-6 w-6 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          `;
        }

        const formData = new FormData(betaForm);

        // Collect all checked assets
        const assetCheckboxes = betaForm.querySelectorAll(
          'input[name="asset"]:checked'
        );
        const assets: string[] = [];
        assetCheckboxes.forEach((cb) => {
          assets.push((cb as HTMLInputElement).value);
        });
        formData.set("assets", assets.join(", "));

        // Convert FormData to JSON
        const object: Record<string, any> = {};
        formData.forEach((value, key) => {
          if (key !== "asset") {
            // Skip individual asset checkboxes since we combined them
            object[key] = value;
          }
        });
        const json = JSON.stringify(object);

        try {
          const response = await fetch("https://api.web3forms.com/submit", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json",
            },
            body: json,
          });

          const data = await response.json();

          if (data.success) {
            // Also send to MailerLite for email automation
            try {
              await fetch("https://connect.mailerlite.com/api/subscribers", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization:
                    "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI0IiwianRpIjoiYzQyMTk3NDQ3ZDU0MmMyNjA3MTY5YTc1M2I1ODI4ZTE4NGJjYjE3Mjk4NzRlZjY3ODBjOTRlYWI3N2VlY2FlOWEzNzFhZjBlNjYzODMwMDUiLCJpYXQiOjE3NTk0OTU5OTIuMTU5MTA1LCJuYmYiOjE3NTk0OTU5OTIuMTU5MTA4LCJleHAiOjQ5MTUxNjk1OTIuMTUyMzQzLCJzdWIiOiIxODQ5NDk4Iiwic2NvcGVzIjpbXX0.nWmJtj0r888960iwgsy7UdmIAoqf7T7gavNhD6a92WiJpLqEZXUe_iyz2SihUnXGoXETy907uB1G_cudgg-VKh4S8ttXwwQA5V4JBjssuOfahmiq7aBuPid3rsZ5VtYctvUGJTA9efHbEbJvIUBYifXhI5nWM3guf-EK0n7q54Vka7KfB9FyXRjhMaLNqRCgYoHcXRDPL09yQpHBSKmgBlP356pD89CI_VP917ojtSkXaGFqHuXkikdfd7iM6xBeRNYNPwq0FrWyfS9sqNWWPPW9ehJYZg_xQFPX3FzVOsIF5P4Ps9Z6eI5nerPuDFqyEscPloKHJhuOSD9BYM6IcQhdBJqEZ7anK849EJzH8RKGlFqUO6ahzvPVmt7S4arpmiq-ChpyA4AFBkb5UK_HE_5QjrjQ722jpGY5RvNRxV4TWInIJrniaBYy404vbMyP095lXj60Qg7YUQO5LCnEDD61oubbNGZ7_gcqwAoheUefLD7sdJ3qiNw6mDRLyUUl4wI8N5T9Ppc6UKuhNViirr7OHFWiWUBYco5lawYYmV4b2aoycHhsHD6m01Q5igbdUFutf1ksXiFbobgygq1WvcTYKT8FA20_pzwkZBpdbVCQ5r8OTL0imCTDFvYLPg19r62XkhW1ZaMbBpchfHASZgmRMNC4oBp76AJKWeUtrgk",
                },
                body: JSON.stringify({
                  email: object.email,
                  fields: {
                    name: object.name,
                    experience: object.experience,
                    gaming: object.gaming,
                    assets: object.assets,
                    tier: object.tier,
                    source: object.source,
                  },
                  groups: ["138840775656014149"], // Beta Signups group
                }),
              });
              console.log("✅ Added to MailerLite automation");
            } catch (mailerliteError) {
              console.error(
                "MailerLite submission failed (non-critical):",
                mailerliteError
              );
              // Don't fail the whole form if MailerLite fails - Web3Forms succeeded
            }

            // Show success message
            if (successMessage) {
              successMessage.classList.remove("hidden");
              betaForm.style.display = "none";
            }

            // Track conversion in analytics
            if (window.gtag) {
              window.gtag("event", "beta_signup", {
                event_category: "engagement",
                event_label: object.tier || "not_selected",
              });
            }

            // Update signup count
            const countElement = document.getElementById("signup-count");
            if (countElement) {
              const currentCount = parseInt(countElement.textContent || "752");
              countElement.textContent = (currentCount + 1).toString();
            }

            // Scroll to success message
            successMessage?.scrollIntoView({
              behavior: "smooth",
              block: "center",
            });
          } else {
            throw new Error("Submission failed");
          }
        } catch (error) {
          console.error("Beta form error:", error);
          if (submitButton) {
            submitButton.innerHTML = "❌ Error - Please try again";
            submitButton.disabled = false;
            setTimeout(() => {
              submitButton.innerHTML = "🚀 Join Beta Waitlist";
            }, 3000);
          }
          alert(
            "Something went wrong. Please try again or email us at info@localaifinance.com"
          );
        }
      });
    }
  });
</script>

<style>
  .experience-option:has(input:checked),
  .tier-option:has(input:checked),
  .asset-option:has(input:checked) {
    @apply border-blue-500 bg-blue-50;
  }
</style>
