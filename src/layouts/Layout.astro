---
import "../styles/global.css";
import Analytics from "@vercel/analytics/astro";

export interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  canonicalUrl?: string;
  noIndex?: boolean;
}

const {
  title,
  description = "Professional AI Financial Assistant - Secure, private financial analysis and trading insights powered by local AI technology.",
  ogImage = "/assets/neurotrader_icon.png",
  canonicalUrl,
  noIndex = false,
} = Astro.props;

const siteUrl = "https://localaifinance.com";
const fullTitle =
  title === "Home"
    ? "LocalAI Finance - Professional AI Financial Assistant"
    : `${title} | LocalAI Finance`;
const fullOgImage = ogImage.startsWith("http")
  ? ogImage
  : `${siteUrl}${ogImage}`;
const fullCanonicalUrl = canonicalUrl || `${siteUrl}${Astro.url.pathname}`;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <!-- Essential Meta Tags -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- SEO Meta Tags -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    {
      !noIndex && (
        <meta
          name="robots"
          content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
        />
      )
    }
    {noIndex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Canonical URL -->
    <link rel="canonical" href={fullCanonicalUrl} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={fullCanonicalUrl} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={fullOgImage} />
    <meta property="og:site_name" content="LocalAI Finance" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={fullCanonicalUrl} />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={fullOgImage} />
    <meta name="twitter:creator" content="@LocalAIFinance" />

    <!-- Favicons and PWA -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Theme and Mobile Optimization -->
    <meta name="theme-color" content="#6366F1" />
    <meta name="color-scheme" content="dark" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="LocalAI Finance" />

    <!-- Performance and Security -->
    <meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width" />

    <!-- DNS Prefetch for external resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />

    <!-- Preload critical resources -->
    <link
      rel="preload"
      href="/assets/neurotrader_icon.png"
      as="image"
      type="image/png"
    />

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <!-- Critical CSS as fallback -->
    <link rel="stylesheet" href="/critical.css" />
    <noscript>
      <link rel="stylesheet" href="/critical.css" />
    </noscript>

    <!-- Enhanced Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "LocalAI Finance",
        "alternateName": "LocalAI",
        "description": "Professional AI Financial Assistant - Secure, private financial analysis and trading insights powered by local AI technology.",
        "url": "https://localaifinance.com",
        "logo": "https://localaifinance.com/assets/neurotrader_icon.png",
        "image": "https://localaifinance.com/assets/neurotrader_icon.png",
        "foundingDate": "2024",
        "sameAs": ["https://github.com/LukeLamb/localaifinance-website"],
        "serviceType": [
          "Financial Technology",
          "AI Services",
          "Financial Analysis"
        ],
        "areaServed": "Worldwide",
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "AI Financial Services",
          "itemListElement": [
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "AI-Powered Financial Analysis",
                "description": "Advanced machine learning algorithms for market analysis and trading insights"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Private Financial Data Processing",
                "description": "Secure, local processing of financial data with complete privacy"
              }
            }
          ]
        },
        "contactPoint": {
          "@type": "ContactPoint",
          "telephone": "+1-555-0123",
          "contactType": "customer service",
          "availableLanguage": ["English"],
          "areaServed": "Worldwide"
        }
      }
    </script>

    <!-- Website Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "LocalAI Finance",
        "url": "https://localaifinance.com",
        "description": "Professional AI Financial Assistant for secure, private financial analysis",
        "inLanguage": "en-US",
        "isAccessibleForFree": true,
        "license": "https://localaifinance.com/terms",
        "copyrightYear": "2024",
        "copyrightHolder": {
          "@type": "Organization",
          "name": "LocalAI Finance"
        }
      }
    </script>

    <!-- Critical CSS inlined to ensure styling loads -->
    <style>
      /* Tailwind CSS Reset and Critical Styles */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        border-width: 0;
        border-style: solid;
        border-color: #e5e7eb;
      }

      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family:
          Inter,
          ui-sans-serif,
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          "Helvetica Neue",
          Arial,
          sans-serif;
        scroll-behavior: smooth;
      }

      body {
        margin: 0;
        line-height: inherit;
        font-family:
          Inter,
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          Oxygen,
          Ubuntu,
          Cantarell,
          sans-serif;
        background: #0F172A;
        color: #F1F5F9;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Container and Layout */
      .container-custom {
        margin-left: auto;
        margin-right: auto;
        max-width: 80rem;
        padding-left: 1rem;
        padding-right: 1rem;
      }

      .min-h-screen {
        min-height: 100vh;
      }
      .flex {
        display: flex;
      }
      .flex-col {
        flex-direction: column;
      }
      .flex-1 {
        flex: 1 1 0%;
      }
      .items-center {
        align-items: center;
      }
      .justify-center {
        justify-content: center;
      }
      .justify-between {
        justify-content: space-between;
      }

      /* Typography */
      .text-hero {
        font-size: 2.25rem;
        line-height: 2.5rem;
        font-weight: 700;
      }
      @media (min-width: 640px) {
        .text-hero {
          font-size: 3rem;
          line-height: 1;
        }
      }
      @media (min-width: 768px) {
        .text-hero {
          font-size: 3.75rem;
          line-height: 1;
        }
      }
      @media (min-width: 1024px) {
        .text-hero {
          font-size: 4.5rem;
          line-height: 1;
        }
      }

      .text-xl {
        font-size: 1.25rem;
        line-height: 1.75rem;
      }
      .text-2xl {
        font-size: 1.5rem;
        line-height: 2rem;
      }
      .text-lg {
        font-size: 1.125rem;
        line-height: 1.75rem;
      }
      .font-bold {
        font-weight: 700;
      }
      .font-semibold {
        font-weight: 600;
      }
      .font-medium {
        font-weight: 500;
      }

      /* Colors */
      .text-gray-900 {
        color: #f5f5dc;
      }
      .text-gray-700 {
        color: #e5e5cc;
      }
      .text-gray-600 {
        color: #d5d5bc;
      }
      .text-white {
        color: #f5f5dc;
      }
      .bg-white {
        background: linear-gradient(135deg, #3e2723 0%, #0a0e27 100%);
      }
      .bg-gray-50 {
        background-color: #1a1e3f;
      }
      .bg-gray-900 {
        background-color: #0a0e27;
      }

      /* Primary Colors - Brass/Copper */
      .text-primary-600 {
        color: #b8860b;
      }
      .bg-primary-600 {
        background-color: #b8860b;
      }
      .bg-primary-50 {
        background-color: #3e2723;
      }

      /* Buttons */
      .btn {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        text-align: center;
        font-weight: 500;
        border-radius: 0.5rem;
        transition: all 0.3s;
        text-decoration: none;
      }

      .btn-primary {
        background: linear-gradient(135deg, #6366F1, #8B5CF6);
        border: none;
        color: white;
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.4), 0 0 40px rgba(99, 102, 241, 0.2);
      }

      .btn-primary:hover {
        transform: scale(1.05);
        box-shadow: 0 0 30px rgba(99, 102, 241, 0.5), 0 0 60px rgba(99, 102, 241, 0.3);
      }

      .btn-outline {
        border: 2px solid #6366F1;
        color: #6366F1;
        background: transparent;
      }

      .btn-outline:hover {
        background: #6366F1;
        color: white;
      }

      /* Gradients */
      .gradient-text {
        background: linear-gradient(
          135deg,
          #6366F1 0%,
          #8B5CF6 50%,
          #06B6D4 100%
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .bg-gradient-to-br {
        background: linear-gradient(to bottom right, var(--tw-gradient-stops));
      }

      .from-blue-50 {
        --tw-gradient-from: #1a1e3f;
      }
      .via-white {
        --tw-gradient-to: #0a0e27;
      }
      .to-emerald-50 {
        --tw-gradient-to: #1a2329;
      }

      .bg-gradient-primary {
        background: linear-gradient(135deg, #b8860b 0%, #00f0ff 100%);
      }

      /* Sections */
      .section {
        padding-top: 4rem;
        padding-bottom: 4rem;
      }
      @media (min-width: 768px) {
        .section {
          padding-top: 6rem;
          padding-bottom: 6rem;
        }
      }

      .section-compact {
        padding-top: 3rem;
        padding-bottom: 3rem;
      }
      @media (min-width: 768px) {
        .section-compact {
          padding-top: 4rem;
          padding-bottom: 4rem;
        }
      }

      /* Navigation */
      .fixed {
        position: fixed;
      }
      .top-0 {
        top: 0;
      }
      .left-0 {
        left: 0;
      }
      .right-0 {
        right: 0;
      }
      .z-40 {
        z-index: 40;
      }
      .h-16 {
        height: 4rem;
      }
      .pt-16 {
        padding-top: 4rem;
      }

      .bg-white\/95 {
        background: linear-gradient(
          135deg,
          rgba(62, 39, 35, 0.95),
          rgba(10, 14, 39, 0.95)
        );
      }
      .backdrop-blur-md {
        backdrop-filter: blur(12px);
      }
      .border-b {
        border-bottom-width: 1px;
      }
      .border-gray-200 {
        border-color: #b8860b;
      }

      /* Spacing */
      .mb-4 {
        margin-bottom: 1rem;
      }
      .mb-6 {
        margin-bottom: 1.5rem;
      }
      .mb-8 {
        margin-bottom: 2rem;
      }
      .mb-16 {
        margin-bottom: 4rem;
      }
      .mt-4 {
        margin-top: 1rem;
      }
      .mt-8 {
        margin-top: 2rem;
      }
      .p-6 {
        padding: 1.5rem;
      }
      .px-4 {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      .py-4 {
        padding-top: 1rem;
        padding-bottom: 1rem;
      }
      .px-8 {
        padding-left: 2rem;
        padding-right: 2rem;
      }

      /* Grid */
      .grid {
        display: grid;
      }
      .grid-cols-1 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
      @media (min-width: 768px) {
        .md\\:grid-cols-2 {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        .md\\:grid-cols-3 {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }
      @media (min-width: 1024px) {
        .lg\\:grid-cols-3 {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }

      .gap-8 {
        gap: 2rem;
      }
      .gap-12 {
        gap: 3rem;
      }

      /* Utilities */
      .text-center {
        text-align: center;
      }
      .max-w-2xl {
        max-width: 42rem;
      }
      .max-w-3xl {
        max-width: 48rem;
      }
      .mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      .block {
        display: block;
      }
      .hidden {
        display: none;
      }
      .space-y-4 > :not([hidden]) ~ :not([hidden]) {
        margin-top: 1rem;
      }

      /* Responsive */
      @media (min-width: 640px) {
        .sm\\:flex-row {
          flex-direction: row;
        }
        .container-custom {
          padding-left: 1.5rem;
          padding-right: 1.5rem;
        }
      }

      @media (min-width: 768px) {
        .md\\:text-2xl {
          font-size: 1.5rem;
          line-height: 2rem;
        }
        .md\\:hidden {
          display: none;
        }
        .md\\:block {
          display: block;
        }
        .container-custom {
          padding-left: 2rem;
          padding-right: 2rem;
        }
      }

      /* Animations */
      .animate-fade-in {
        opacity: 0;
        animation: fadeIn 0.6s ease-in forwards;
      }

      .animate-slide-up {
        transform: translateY(2rem);
        opacity: 0;
        animation: slideUp 0.6s ease-out forwards;
      }

      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      /* Feature Cards */
      .feature-card {
        background: linear-gradient(135deg, #3e2723 0%, #0a0e27 100%);
        padding: 1.5rem;
        border-radius: 0.75rem;
        border: 1px solid #b8860b;
        box-shadow:
          0 4px 6px -1px rgba(0, 0, 0, 0.3),
          inset 0 0 20px rgba(184, 134, 11, 0.1),
          0 0 0 1px rgba(0, 240, 255, 0.2);
        transition: all 0.3s ease;
      }

      .feature-card:hover {
        transform: translateY(-0.25rem);
        box-shadow:
          0 10px 15px -3px rgba(0, 0, 0, 0.3),
          inset 0 0 20px rgba(184, 134, 11, 0.2),
          0 0 20px rgba(0, 240, 255, 0.4);
      }
    </style>
  </head>

  <body class="font-primary bg-white text-gray-900 antialiased">
    <!-- Skip to main content for accessibility -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary-600 text-white px-4 py-2 rounded-lg z-50"
    >
      Skip to main content
    </a>

    <!-- Mobile-first responsive wrapper -->
    <div class="min-h-screen flex flex-col">
      <!-- Navigation will go here -->
      <header
        id="header"
        class="fixed top-0 left-0 right-0 z-40 bg-white/95 backdrop-blur-md border-b border-gray-200"
      >
        <!-- Navigation component will be inserted here -->
        <slot name="navigation" />
      </header>

      <!-- Main Content with proper spacing for fixed header -->
      <main id="main-content" class="flex-1 pt-16">
        <slot />
      </main>

      <!-- Footer -->
      <footer class="bg-gray-900 text-white">
        <!-- Footer component will be inserted here -->
        <slot name="footer" />
      </footer>
    </div>

    <!-- Mobile Detection and Optimization Script -->
    <script>
      // Mobile detection and touch optimization
      (function () {
        // Add mobile class for CSS targeting
        if (
          /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          )
        ) {
          document.documentElement.classList.add("is-mobile");
        }

        // Touch device detection
        if ("ontouchstart" in window || navigator.maxTouchPoints > 0) {
          document.documentElement.classList.add("is-touch");
        }

        // Viewport height fix for mobile browsers
        function setVH() {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty("--vh", `${vh}px`);
        }

        setVH();
        window.addEventListener("resize", setVH);
        window.addEventListener("orientationchange", () => {
          setTimeout(setVH, 500);
        });

        // Prevent zoom on double-tap for better UX
        let lastTouchEnd = 0;
        document.addEventListener(
          "touchend",
          function (event) {
            const now = new Date().getTime();
            if (now - lastTouchEnd <= 300) {
              event.preventDefault();
            }
            lastTouchEnd = now;
          },
          false
        );

        // Smooth scroll polyfill for Safari iOS
        if (!CSS.supports("scroll-behavior", "smooth")) {
          const script = document.createElement("script");
          script.src =
            "https://cdn.jsdelivr.net/gh/iamdustan/smoothscroll@1.4.10/src/smoothscroll.min.js";
          document.head.appendChild(script);
        }
      })();
    </script>

    <!-- Performance monitoring -->
    <script>
      // Basic performance monitoring
      window.addEventListener("load", function () {
        // Log Core Web Vitals if available
        if ("web-vitals" in window) {
          // Would integrate with actual monitoring service
          console.log("Page loaded successfully");
        }
      });
    </script>

    <!-- Service Worker Registration -->
    <!-- Temporarily disabled for debugging -->
    <!--
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log("SW registered: ", registration);
            })
            .catch((registrationError) => {
              console.log("SW registration failed: ", registrationError);
            });
        });
      }
    </script>
    -->

    <!-- Scroll-Triggered Animations -->
    <script>
      // Enhanced scroll animations using Intersection Observer
      document.addEventListener("DOMContentLoaded", () => {
        const observerOptions = {
          threshold: 0.1,
          rootMargin: "0px 0px -50px 0px",
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("animate-in");
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        // Observe elements with animation classes
        document
          .querySelectorAll(
            ".animate-fade-in, .animate-slide-up, .feature-card"
          )
          .forEach((el) => {
            observer.observe(el);
          });
      });
    </script>

    <!-- CSS Loader for deployment compatibility -->
    <script src="/css-loader.js" is:inline></script>

    <!-- Core Web Vitals Monitoring -->
    <!-- Temporarily disabled for debugging -->
    <!-- <script src="/web-vitals.js" is:inline></script> -->

    <!-- Vercel Analytics -->
    <Analytics />

    <!-- Google Analytics 4 -->
    <!-- Replace G-XXXXXXXXXX with your actual GA4 Measurement ID -->
    <script
      type="text/partytown"
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"
    ></script>
    <script type="text/partytown">
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-XXXXXXXXXX");
    </script>
  </body>
</html>
